{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "You passed along `num_labels=3` with an incompatible id to label map: {'0': 'NEGATIVE', '1': 'POSITIVE'}. The number of labels wil be overwritten to 2.\n"
     ]
    },
    {
     "ename": "IndexError",
     "evalue": "list index out of range",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mIndexError\u001b[0m                                Traceback (most recent call last)",
      "Cell \u001b[1;32mIn[1], line 121\u001b[0m, in \u001b[0;36mNewsViewer.show_news\u001b[1;34m(self, item)\u001b[0m\n\u001b[0;32m    119\u001b[0m \u001b[38;5;250m\u001b[39m\u001b[38;5;124;03m\"\"\"ğŸ“œ ì„ íƒí•œ ë‰´ìŠ¤ ë³¸ë¬¸ í‘œì‹œ\"\"\"\u001b[39;00m\n\u001b[0;32m    120\u001b[0m index \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mnews_list\u001b[38;5;241m.\u001b[39mrow(item)\n\u001b[1;32m--> 121\u001b[0m title, link, content \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mnews_data\u001b[49m\u001b[43m[\u001b[49m\u001b[43mindex\u001b[49m\u001b[43m]\u001b[49m\n\u001b[0;32m    123\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mtitle_label\u001b[38;5;241m.\u001b[39msetText(title)\n\u001b[0;32m    124\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mnews_content\u001b[38;5;241m.\u001b[39msetText(content)\n",
      "\u001b[1;31mIndexError\u001b[0m: list index out of range"
     ]
    },
    {
     "ename": "SystemExit",
     "evalue": "0",
     "output_type": "error",
     "traceback": [
      "An exception has occurred, use %tb to see the full traceback.\n",
      "\u001b[1;31mSystemExit\u001b[0m\u001b[1;31m:\u001b[0m 0\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\82106\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python312\\site-packages\\IPython\\core\\interactiveshell.py:3587: UserWarning: To exit: use 'exit', 'quit', or Ctrl-D.\n",
      "  warn(\"To exit: use 'exit', 'quit', or Ctrl-D.\", stacklevel=1)\n"
     ]
    }
   ],
   "source": [
    "import sys\n",
    "import csv\n",
    "import os\n",
    "import webbrowser\n",
    "from transformers import BartForConditionalGeneration, PreTrainedTokenizerFast\n",
    "from PyQt5.QtWidgets import QApplication, QMainWindow, QListWidget, QLabel, QTextEdit, QPushButton, QVBoxLayout, QHBoxLayout, QWidget, QLineEdit\n",
    "from PyQt5.QtGui import QFont\n",
    "\n",
    "# âœ… CSV íŒŒì¼ ê²½ë¡œ\n",
    "CSV_FILE_PATH = r\"C:\\pthon_basic\\webcrolingProject\\news_crawler_project\\data\\naver_news.csv\"\n",
    "\n",
    "# KoBART ëª¨ë¸ ê²½ë¡œ\n",
    "MODEL_PATH = \"digit82/kobart-summarization\"\n",
    "tokenizer = PreTrainedTokenizerFast.from_pretrained(MODEL_PATH)\n",
    "model = BartForConditionalGeneration.from_pretrained(MODEL_PATH)\n",
    "\n",
    "class NewsViewer(QMainWindow):\n",
    "    def __init__(self):\n",
    "        super().__init__()\n",
    "\n",
    "        # ìœˆë„ìš° ì„¤ì •\n",
    "        self.setWindowTitle(\"ë„¤ì´ë²„ ê²½ì œ ë‰´ìŠ¤ ë·°ì–´\")\n",
    "        self.setGeometry(100, 100, 900, 650)  # ì°½ í¬ê¸° ì¡°ì •\n",
    "\n",
    "        # ë©”ì¸ ë ˆì´ì•„ì›ƒ\n",
    "        layout = QHBoxLayout()\n",
    "\n",
    "        # ğŸ” ì™¼ìª½ ê²€ìƒ‰ì°½ ë° ë‰´ìŠ¤ ë¦¬ìŠ¤íŠ¸\n",
    "        left_layout = QVBoxLayout()\n",
    "\n",
    "        self.search_input = QLineEdit(self)\n",
    "        self.search_input.setPlaceholderText(\"ğŸ” ê²€ìƒ‰ì–´ ì…ë ¥ í›„ Enter\")\n",
    "        self.search_input.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.search_input.returnPressed.connect(self.update_news_list)\n",
    "        left_layout.addWidget(self.search_input)\n",
    "\n",
    "        # ğŸ“Œ ë‰´ìŠ¤ ë¦¬ìŠ¤íŠ¸\n",
    "        self.news_list = QListWidget(self)\n",
    "        self.news_list.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.news_list.itemClicked.connect(self.show_news)\n",
    "        left_layout.addWidget(self.news_list)\n",
    "\n",
    "        # ë‰´ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼\n",
    "        self.load_button = QPushButton(\"ğŸ”„ ë‰´ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸°\", self)\n",
    "        self.load_button.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.load_button.clicked.connect(self.load_news)\n",
    "        left_layout.addWidget(self.load_button)\n",
    "\n",
    "        # ì˜¤ë¥¸ìª½ ë‰´ìŠ¤ ì œëª©ê³¼ ë³¸ë¬¸ í‘œì‹œ ë ˆì´ì•„ì›ƒ\n",
    "        right_layout = QVBoxLayout()\n",
    "\n",
    "        # ğŸ“° ë‰´ìŠ¤ ì œëª©\n",
    "        self.title_label = QLabel(\"ë‰´ìŠ¤ ì œëª©\", self)\n",
    "        self.title_label.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 16, QFont.Weight.Bold))\n",
    "        right_layout.addWidget(self.title_label)\n",
    "\n",
    "        # ğŸ“œ ë‰´ìŠ¤ ë³¸ë¬¸\n",
    "        self.news_content = QTextEdit(self)\n",
    "        self.news_content.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.news_content.setReadOnly(True)\n",
    "        right_layout.addWidget(self.news_content)\n",
    "\n",
    "        # ìš”ì•½ ë²„íŠ¼ ì¶”ê°€\n",
    "        self.summarize_button = QPushButton(\"ğŸ“‘ ìš”ì•½í•˜ê¸°\", self)\n",
    "        self.summarize_button.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.summarize_button.clicked.connect(self.summarize_news)\n",
    "        right_layout.addWidget(self.summarize_button)\n",
    "\n",
    "        # ë‰´ìŠ¤ ë§í¬ (í´ë¦­í•˜ë©´ ì›¹ì—ì„œ ì—´ë¦¼)\n",
    "        self.link_label = QLabel(\"\", self)\n",
    "        self.link_label.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.link_label.setStyleSheet(\"color: blue; text-decoration: underline; cursor: pointer;\")\n",
    "        self.link_label.mousePressEvent = self.open_link\n",
    "        right_layout.addWidget(self.link_label)\n",
    "\n",
    "        layout.addLayout(left_layout)\n",
    "        layout.addLayout(right_layout)\n",
    "\n",
    "        # ì¤‘ì•™ ìœ„ì ¯ ì„¤ì •\n",
    "        central_widget = QWidget()\n",
    "        central_widget.setLayout(layout)\n",
    "        self.setCentralWidget(central_widget)\n",
    "\n",
    "        # ë‰´ìŠ¤ ë°ì´í„° ì €ì¥í•  ë¦¬ìŠ¤íŠ¸\n",
    "        self.news_data = []\n",
    "        self.load_news()\n",
    "\n",
    "    def load_news(self):\n",
    "        \"\"\"ğŸ“Œ CSV íŒŒì¼ì—ì„œ ë‰´ìŠ¤ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°\"\"\"\n",
    "        self.news_list.clear()\n",
    "        self.news_data.clear()\n",
    "\n",
    "        if not os.path.exists(CSV_FILE_PATH):\n",
    "            self.news_list.addItem(\"âš ï¸ ë‰´ìŠ¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!\")\n",
    "            return\n",
    "\n",
    "        try:\n",
    "            with open(CSV_FILE_PATH, \"r\", encoding=\"utf-8\") as file:\n",
    "                reader = csv.reader(file)\n",
    "                next(reader)  # ì²« ë²ˆì§¸ ì¤„(í—¤ë”) ê±´ë„ˆë›°ê¸°\n",
    "                for row in reader:\n",
    "                    if len(row) < 3:\n",
    "                        continue\n",
    "                    title, link, content = row\n",
    "                    self.news_data.append((title, link, content))\n",
    "                    self.news_list.addItem(title)  # ë‰´ìŠ¤ ì œëª© ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€\n",
    "        except Exception as e:\n",
    "            self.news_list.addItem(f\"âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {e}\")\n",
    "\n",
    "    def update_news_list(self):\n",
    "        \"\"\"ğŸ” ê²€ìƒ‰ ê¸°ëŠ¥ - í‚¤ì›Œë“œê°€ í¬í•¨ëœ ë‰´ìŠ¤ë§Œ í‘œì‹œ\"\"\"\n",
    "        keyword = self.search_input.text().strip().lower()\n",
    "        self.news_list.clear()\n",
    "        for title, link, content in self.news_data:\n",
    "            if keyword in title.lower() or keyword in content.lower():\n",
    "                self.news_list.addItem(title)\n",
    "\n",
    "    def show_news(self, item):\n",
    "        \"\"\"ğŸ“œ ì„ íƒí•œ ë‰´ìŠ¤ ë³¸ë¬¸ í‘œì‹œ\"\"\"\n",
    "        index = self.news_list.row(item)\n",
    "        title, link, content = self.news_data[index]\n",
    "\n",
    "        self.title_label.setText(title)\n",
    "        self.news_content.setText(content)\n",
    "        self.link_label.setText(link)\n",
    "\n",
    "        self.link_label.setStyleSheet(\"color: blue; text-decoration: underline; cursor: pointer;\")\n",
    "        self.current_link = link\n",
    "\n",
    "    def open_link(self, event):\n",
    "        \"\"\"ğŸŒ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ë‰´ìŠ¤ ë§í¬ ì—´ê¸°\"\"\"\n",
    "        if hasattr(self, \"current_link\"):\n",
    "            webbrowser.open(self.current_link)\n",
    "\n",
    "    def summarize_news(self):\n",
    "        \"\"\"ğŸ“‘ KoBART ëª¨ë¸ì„ ì´ìš©í•´ ë‰´ìŠ¤ ë³¸ë¬¸ ìš”ì•½\"\"\"\n",
    "        content = self.news_content.toPlainText()\n",
    "        inputs = tokenizer.encode(\"summarize: \" + content, return_tensors=\"pt\")\n",
    "\n",
    "        summary_ids = model.generate(\n",
    "            inputs,\n",
    "            max_length=150,\n",
    "            num_beams=4,\n",
    "            no_repeat_ngram_size=2,\n",
    "            early_stopping=True\n",
    "        )\n",
    "\n",
    "        summary = tokenizer.decode(summary_ids[0], skip_special_tokens=True)\n",
    "        self.news_content.setText(summary)\n",
    "\n",
    "# ì‹¤í–‰ ì½”ë“œ\n",
    "if __name__ == \"__main__\":\n",
    "    app = QApplication(sys.argv)\n",
    "    viewer = NewsViewer()\n",
    "    viewer.show()\n",
    "    sys.exit(app.exec_())\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "You passed along `num_labels=3` with an incompatible id to label map: {'0': 'NEGATIVE', '1': 'POSITIVE'}. The number of labels wil be overwritten to 2.\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "0"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import sys\n",
    "import csv\n",
    "import os\n",
    "import webbrowser\n",
    "from transformers import BartForConditionalGeneration, PreTrainedTokenizerFast\n",
    "from PyQt5.QtWidgets import QApplication, QMainWindow, QListWidget, QLabel, QTextEdit, QPushButton, QVBoxLayout, QHBoxLayout, QWidget, QLineEdit\n",
    "from PyQt5.QtGui import QFont\n",
    "\n",
    "# âœ… CSV íŒŒì¼ ê²½ë¡œ\n",
    "CSV_FILE_PATH = r\"C:\\pthon_basic\\webcrolingProject\\news_crawler_project\\data\\naver_news.csv\"\n",
    "\n",
    "# âœ… KoBART ëª¨ë¸ ë¡œë“œ\n",
    "MODEL_PATH = \"digit82/kobart-summarization\"\n",
    "tokenizer = PreTrainedTokenizerFast.from_pretrained(MODEL_PATH)\n",
    "model = BartForConditionalGeneration.from_pretrained(MODEL_PATH)\n",
    "\n",
    "class NewsViewer(QMainWindow):\n",
    "    def __init__(self):\n",
    "        super().__init__()\n",
    "\n",
    "        self.setWindowTitle(\"ë„¤ì´ë²„ ê²½ì œ ë‰´ìŠ¤ ë·°ì–´\")\n",
    "        self.setGeometry(100, 100, 900, 650)\n",
    "\n",
    "        layout = QHBoxLayout()\n",
    "        left_layout = QVBoxLayout()\n",
    "\n",
    "        self.search_input = QLineEdit(self)\n",
    "        self.search_input.setPlaceholderText(\"ğŸ” ê²€ìƒ‰ì–´ ì…ë ¥ í›„ Enter\")\n",
    "        self.search_input.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.search_input.returnPressed.connect(self.update_news_list)\n",
    "        left_layout.addWidget(self.search_input)\n",
    "\n",
    "        self.news_list = QListWidget(self)\n",
    "        self.news_list.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.news_list.itemClicked.connect(self.show_news)\n",
    "        left_layout.addWidget(self.news_list)\n",
    "\n",
    "        self.load_button = QPushButton(\"ğŸ”„ ë‰´ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸°\", self)\n",
    "        self.load_button.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.load_button.clicked.connect(self.load_news)\n",
    "        left_layout.addWidget(self.load_button)\n",
    "\n",
    "        right_layout = QVBoxLayout()\n",
    "\n",
    "        self.title_label = QLabel(\"ë‰´ìŠ¤ ì œëª©\", self)\n",
    "        self.title_label.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 16, QFont.Weight.Bold))\n",
    "        right_layout.addWidget(self.title_label)\n",
    "\n",
    "        self.news_content = QTextEdit(self)\n",
    "        self.news_content.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.news_content.setReadOnly(True)\n",
    "        right_layout.addWidget(self.news_content)\n",
    "\n",
    "        self.summarize_button = QPushButton(\"ğŸ“‘ ìš”ì•½í•˜ê¸°\", self)\n",
    "        self.summarize_button.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.summarize_button.clicked.connect(self.summarize_news)\n",
    "        right_layout.addWidget(self.summarize_button)\n",
    "\n",
    "        self.link_label = QLabel(\"\", self)\n",
    "        self.link_label.setFont(QFont(\"ë§‘ì€ ê³ ë”•\", 14))\n",
    "        self.link_label.setStyleSheet(\"color: blue; text-decoration: underline; cursor: pointer;\")\n",
    "        self.link_label.mousePressEvent = self.open_link\n",
    "        right_layout.addWidget(self.link_label)\n",
    "\n",
    "        layout.addLayout(left_layout)\n",
    "        layout.addLayout(right_layout)\n",
    "\n",
    "        central_widget = QWidget()\n",
    "        central_widget.setLayout(layout)\n",
    "        self.setCentralWidget(central_widget)\n",
    "\n",
    "        self.news_data = []\n",
    "        self.filtered_news_data = []\n",
    "\n",
    "        self.load_news()\n",
    "\n",
    "    def load_news(self):\n",
    "        self.news_list.clear()\n",
    "        self.news_data.clear()\n",
    "        self.filtered_news_data.clear()\n",
    "\n",
    "        if not os.path.exists(CSV_FILE_PATH):\n",
    "            self.news_list.addItem(\"âš ï¸ ë‰´ìŠ¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!\")\n",
    "            return\n",
    "\n",
    "        try:\n",
    "            with open(CSV_FILE_PATH, \"r\", encoding=\"utf-8\") as file:\n",
    "                reader = csv.reader(file)\n",
    "                next(reader)  # í—¤ë” ê±´ë„ˆë›°ê¸°\n",
    "                for row in reader:\n",
    "                    if len(row) < 3:\n",
    "                        continue\n",
    "                    title, link, content = row[:3]  # ì•ì˜ 3ê°œë§Œ ê°€ì ¸ì˜´\n",
    "                    self.news_data.append((title, link, content))\n",
    "\n",
    "            self.filtered_news_data = self.news_data.copy()\n",
    "            for title, _, _ in self.filtered_news_data:\n",
    "                self.news_list.addItem(title)\n",
    "\n",
    "        except Exception as e:\n",
    "            self.news_list.addItem(f\"âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {e}\")\n",
    "\n",
    "    def update_news_list(self):\n",
    "        keyword = self.search_input.text().strip().lower()\n",
    "        self.news_list.clear()\n",
    "\n",
    "        self.filtered_news_data = [\n",
    "            (title, link, content)\n",
    "            for title, link, content in self.news_data\n",
    "            if keyword in title.lower() or keyword in content.lower()\n",
    "        ]\n",
    "\n",
    "        for title, _, _ in self.filtered_news_data:\n",
    "            self.news_list.addItem(title)\n",
    "\n",
    "    def show_news(self, item):\n",
    "        index = self.news_list.row(item)\n",
    "        if 0 <= index < len(self.filtered_news_data):\n",
    "            title, link, content = self.filtered_news_data[index]\n",
    "            self.title_label.setText(title)\n",
    "            self.news_content.setText(content)\n",
    "            self.link_label.setText(link)\n",
    "            self.current_link = link\n",
    "\n",
    "    def open_link(self, event):\n",
    "        if hasattr(self, \"current_link\"):\n",
    "            webbrowser.open(self.current_link)\n",
    "\n",
    "    def summarize_news(self):\n",
    "        content = self.news_content.toPlainText().strip()\n",
    "        if not content:\n",
    "            return\n",
    "\n",
    "        inputs = tokenizer.encode(\"summarize: \" + content, return_tensors=\"pt\")\n",
    "        summary_ids = model.generate(\n",
    "            inputs,\n",
    "            max_length=150,\n",
    "            num_beams=4,\n",
    "            no_repeat_ngram_size=2,\n",
    "            early_stopping=True\n",
    "        )\n",
    "        summary = tokenizer.decode(summary_ids[0], skip_special_tokens=True)\n",
    "        self.news_content.setText(summary)\n",
    "\n",
    "# âœ… Jupyterì—ì„œ ì‹¤í–‰\n",
    "app = QApplication.instance() or QApplication(sys.argv)\n",
    "viewer = NewsViewer()\n",
    "viewer.show()\n",
    "app.exec_()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.9"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
